#!/bin/sh
sleep 1
echo "\033[;32m"\\nHotPi-PPP will now be installed on your system...
sleep 3
echo \\nPress \""\033[;37m"ENTER"\033[;32m"\" to continue...
read hotpips
apt update
apt upgrade -y
apt install bridge-utils dnsmasq hostapd ppp resolvconf samba xrdp -y
sed -i s/console=serial0,115200\ // /boot/cmdline.txt
echo dtoverlay=pi3-disable-bt >> /boot/config.txt
echo \#!/bin/sh\\npppd connect \"chat \'\' atd*99#\" /dev/ttyAMA0 crtscts 3000000 :10.64.64.64 usepeerdns defaultroute noauth persist updetach > /bin/hotpi-startppp
chmod 755 /bin/hotpi-startppp
echo \#!/bin/sh\\npoff \&\& echo The PPP connection has been stopped. > /bin/hotpi-stopppp
chmod 755 /bin/hotpi-stopppp

echo \#!/bin/sh\\nsleep 1\\necho '"\\033[;32m"\\\\nEnter your Wi-Fi country code \(United States: US, Canada: CA, United Kingdom: UK\):\\\\'n\\nread hotpicc\\nsleep 1\\necho '\\\\'nYour Wi-Fi country code has been set to "'"'"'"'"'"\\033[;37m"$hotpicc"\\033[;32m"'"'"'"'"'"...\\nsleep 3\\necho '\\\\nCreate your Wi-Fi network name \(no special characters or spaces\):\\\\'n\\nread hotpinn\\nsleep 1\\necho '\\\\'nYour Wi-Fi network name has been set to "'"'"'"'"'"\\033[;37m"$hotpinn"\\033[;32m"'"'"'"'"'"...\\nsleep 3\\necho '\\\\nCreate your Wi-Fi network password \(no special characters or spaces\):\\\\'n\\nread hotpinp\\nsleep 1\\necho '\\\\'nYour Wi-Fi network password has been set to "'"'"'"'"'"\\033[;37m"$hotpinp"\\033[;32m"'"'"'"'"'"...\\nsleep 3\\necho '\\\\'nShould you wish to change these settings, you may do so using the "'"'"'"'"'"\\033[;37m"sudo hotpi-setwifi"\\033[;32m"'"'"'"'"'" command in Terminal...\\nsleep 3\\necho '\\\\'nPress "'"'"'"'"'"\\033[;37m"ENTER"\\033[;32m"'"'"'"'"'" to continue...\\nread hotpips\\necho interface=wlan0'\\\\nbridge=br0\\\\ncountry_code=$hotpicc\\\\nieee80211ac=1\\\\nwmm_enabled=1\\\\nhw_mode=a\\\\nchannel=36\\\\nht_capab=[HT40+]\\\\nssid=$hotpinn\\\\nwpa_passphrase=$hotpinp\\\\nwpa=2\\\\nwpa_key_mgmt=WPA-PSK\\\\nrsn_pairwise=CCMP >' /etc/hostapd/hostapd.conf > /bin/hotpi-setwifi

echo \#!/bin/sh\\nsleep 1\\necho '\\\\nEnter your Wi-Fi country code \(United States: US, Canada: CA, United Kingdom: UK\):\\\\n'\\nread hotpicc\\nsleep 1\\necho '\\\\nYour Wi-Fi country code has been set to $'hotpicc...\\nsleep 3\\necho '\\\\nCreate your Wi-Fi network name \(no special characters or spaces\):\\\\n'\\nread hotpinn\\nsleep 1\\necho '\\\\nYour Wi-Fi network name has been set to $'hotpinn...\\nsleep 3\\necho '\\\\nCreate your Wi-Fi network password \(no special characters or spaces\):\\\\n'\\nread hotpinp\\nsleep 1\\necho '\\\\nYour Wi-Fi network password has been set to $'hotpinp...\\nsleep 3\\necho '\\\\n'Should you wish to change these settings, you may do so using the sudo hotpi-setwifi command in Terminal...\\nsleep 3\\necho '\\\\n'Press ENTER to continue...\\nread hotpips\\necho \"interface=wlan0\\nbridge=br0\\ncountry_code=\$hotpicc\\nieee80211ac=1\\nwmm_enabled=1\\nhw_mode=a\\nchannel=36\\nht_capab=[HT40+]\\nssid=\$hotpinn\\nwpa_passphrase=\$hotpinp\\nwpa=2\\nwpa_key_mgmt=WPA-PSK\\nrsn_pairwise=CCMP\" \> /etc/hostapd/hostapd.conf > /bin/hotpi-setwifi

echo \#!/bin/sh\\nsleep 1\\necho \"\\\\033[\;32m\"\\\\\\\\nEnter your Wi-Fi country code \\\(United States: US, Canada: CA, United Kingdom: UK\\\):\\\\\\\\n\\nread hotpicc\\nsleep 1\\necho \\\\\\\\nYour Wi-Fi country code has been set to \'\"\'\"\\\\033[\;37m\"\$hotpicc\"\\\\033[\;32m\"\'\"\'...\\nsleep 3\\necho \\\\\\\\nCreate your Wi-Fi network name \\\(no special characters or spaces\\\):\\\\\\\\n\\nread hotpinn\\nsleep 1\\necho \\\\\\\\nYour Wi-Fi network name has been set to \'\"\'\"\\\\033[\;37m\"\$hotpinn\"\\\\033[\;32m\"\'\"\'...\\nsleep 3\\necho \\\\\\\\nCreate your Wi-Fi network password \\\(no special characters or spaces\\\):\\\\\\\\n\\nread hotpinp\\nsleep 1\\necho \\\\\\\\nYour Wi-Fi network password has been set to \'\"\'\"\\\\033[\;37m\"\$hotpinp\"\\\\033[\;32m\"\'\"\'...\\nsleep 3\\necho \\\\\\\\nShould you wish to change these settings, you may do so using the \'\"\'\"\\\\033[\;37m\"sudo hotpi-setwifi\"\\\\033[\;32m\"\'\"\' command in Terminal...\\nsleep 3\\necho \\\\\\\\nPress \'\"\'\"\\\\033[\;37m\"ENTER\"\\\\033[\;32m\"\'\"\' to continue...\\nread hotpips\\necho interface=wlan0\\\\\\\\nbridge=br0\\\\\\\\ncountry_code=\$hotpicc\\\\\\\\nieee80211ac=1\\\\\\\\nwmm_enabled=1\\\\\\\\nhw_mode=a\\\\\\\\nchannel=36\\\\\\\\nht_capab=[HT40+]\\\\\\\\nssid=\$hotpinn\\\\\\\\nwpa_passphrase=\$hotpinp\\\\\\\\nwpa=2\\\\\\\\nwpa_key_mgmt=WPA-PSK\\\\\\\\nrsn_pairwise=CCMP \> /etc/hostapd/hostapd.conf > /bin/hotpi-setwifi

chmod 755 /bin/hotpi-setwifi
hotpi-setwifi
echo allow-hotplug br0\\niface br0 inet static\\naddress 192.168.0.1\\nbridge_ports wlan0 eth0 >> /etc/network/interfaces
echo interface=br0\\ndhcp-range=192.168.0.2,192.168.0.10,24h >> /etc/dnsmasq.conf
sed -i s/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/ /etc/sysctl.conf
iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE
iptables-save > /etc/iptables
echo [External Storage]\\npath = /media/pi\\npublic = yes\\nwriteable = yes >> /etc/samba/smb.conf
mkdir /media/pi
chmod -R 777 /media/pi
echo \#!/bin/sh\\necho \"\\nHotPi-PPP \(GPIO - 3 Mbps\)\\n\\n\\nCommand List:\\n\\n\\nsudo hotpi-help - List available commands\\n\\nsudo hotpi-installppp - Install HotPi-PPP\\n\\nsudo hotpi-setwifi - Set Wi-Fi settings\\n\\nsudo hotpi-startppp - Start PPP connection\\n\\nsudo hotpi-stopppp - Stop PPP connection\\n\" > /bin/hotpi-help
chmod 755 /bin/hotpi-help
sed -i s/^exit\ 0/tail\ -n\ +40\ \\/bin\\/hotpi-installppp\ \|\ sh\\nexit\ 0/ /etc/rc.local
systemctl unmask hostapd
systemctl enable hostapd resolvconf
sleep 1
echo \\nHotPi-PPP has been successfully installed on your system...
sleep 3
echo \\nFor a detailed list of available commands, you may use the \""\033[;37m"sudo hotpi-help"\033[;32m"\" command in Terminal...
sleep 3
echo \\nPress \""\033[;37m"ENTER"\033[;32m"\" to reboot...
read hotpips
reboot
stty -F /dev/ttyAMA0 115200
chat '' at+cgdcont=1,\"ipv4v6\" OK at+iprex=3000000 OK > /dev/ttyAMA0 < /dev/ttyAMA0
sed -i s/tail\ -n\ +40\ \\/bin\\/hotpi-installppp\ \|\ sh/stty\ -F\ \\/dev\\/ttyAMA0\ 3000000\\nhotpi-startppp\\niptables-restore\ \<\ \\/etc\\/iptables/ /etc/rc.local
reboot
