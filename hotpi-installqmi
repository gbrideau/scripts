#!/bin/sh
sleep 1 ; echo \\nHotPi-QMI will now be installed on your system...
sleep 3 ; echo \\nPress '"'"\033[;37m"ENTER"\033[;32m"'"' to continue...
read hotpips
apt update && apt upgrade -y
apt install bridge-utils dnsmasq hostapd libqmi-utils resolvconf samba udhcpc xrdp -y
echo \#!/bin/sh\\nqmicli -d /dev/cdc-wdm0 --dms-set-operating-mode=online\\nqmicli -d /dev/cdc-wdm0 -E raw-ip \&\& qmicli -d /dev/cdc-wdm0 -p --wds-start-network=ip-type=4 --client-no-release-cid \&\& udhcpc -i wwan0 > /bin/hotpi-startqmi
chmod 755 /bin/hotpi-startqmi
echo \#!/bin/sh\\nifconfig wwan0 down \&\& echo The QMI connection has been stopped. > /bin/hotpi-stopqmi
chmod 755 /bin/hotpi-stopqmi
echo \#!/bin/sh\\nsleep 1\\necho '\\\\nEnter your Wi-Fi country code \(US or CA for United States or Canada\):\\\\'n\\nread hotpicc\\nsleep 1\\necho '\\\\'nYour Wi-Fi country code has been set to "'"'"'"'"'"\033[;37m"$hotpicc"\033[;32m"'"'"'"'"'"...\\nsleep 3\\necho '\\\\nCreate your Wi-Fi network name \(no special characters or spaces\):\\\\'n\\nread hotpinn\\nsleep 1\\necho '\\\\'nYour Wi-Fi network name has been set to "'"'"'"'"'"\033[;37m"$hotpinn"\033[;32m"'"'"'"'"'"...\\nsleep 3\\necho '\\\\nCreate your Wi-Fi network password \(no special characters or spaces\):\\\\'n\\nread hotpinp\\nsleep 1\\necho '\\\\'nYour Wi-Fi network password has been set to "'"'"'"'"'"\033[;37m"$hotpinp"\033[;32m"'"'"'"'"'"...\\nsleep 3\\necho '\\\\'nShould you wish to change these settings, you may do so using the "'"'"'"\033[;37m"sudo hotpi-setwifi"\033[;32m"'"'"'" command in Terminal...\\nsleep 3\\necho '\\\\'nPress "'"'"'"\033[;37m"ENTER"\033[;32m"'"'"'" to continue...\\nread hotpips\\necho interface=wlan0'\\\\nbridge=br0\\\\ncountry_code=$hotpicc\\\\nieee80211ac=1\\\\nwmm_enabled=1\\\\nhw_mode=a\\\\nchannel=36\\\\nht_capab=[HT40+]\\\\nssid=$hotpinn\\\\nwpa_passphrase=$hotpinp\\\\nwpa=2\\\\nwpa_key_mgmt=WPA-PSK\\\\nrsn_pairwise=CCMP >' /etc/hostapd/hostapd.conf > /bin/hotpi-setwifi
chmod 755 /bin/hotpi-setwifi
hotpi-setwifi
echo allow-hotplug br0\\niface br0 inet static\\naddress 192.168.0.1\\nbridge_ports wlan0 eth0 >> /etc/network/interfaces
echo interface=br0\\ndhcp-range=192.168.0.2,192.168.0.10,24h >> /etc/dnsmasq.conf
sed -i s/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/ /etc/sysctl.conf
iptables -t nat -A POSTROUTING -o wwan0 -j MASQUERADE
iptables-save > /etc/iptables
echo [External Storage]\\npath = /media/pi\\npublic = yes\\nwriteable = yes >> /etc/samba/smb.conf
mkdir /media/pi
chmod -R 777 /media/pi
echo \#!/bin/sh\\necho '\\\\nHotPi-QMI \(USB - 150 Mbps\)\\\\n\\\\n\\\\nCommand List\\\\n\\\\n\\\\nsudo hotpi-help - List available commands\\\\n\\\\nsudo hotpi-installqmi - Install HotPi-QMI\\\\n\\\\nsudo hotpi-setwifi - Set Wi-Fi settings\\\\n\\\\nsudo hotpi-startqmi - Start QMI connection\\\\n\\\\nsudo hotpi-stopqmi - Stop QMI connection\\\\'n > /bin/hotpi-help
chmod 755 /bin/hotpi-help
sed -i s/^exit\ 0/hotpi-startqmi\ \;\ iptables-restore\ \<\ \\/etc\\/iptables\\nexit\ 0/ /etc/rc.local
systemctl unmask hostapd
systemctl enable hostapd resolvconf
sleep 1 ; echo \\nHotPi-QMI has been successfully installed on your system. For a detailed list of available commands, you may use the '"'"\033[;37m"sudo hotpi-help"\033[;32m"'"' command in Terminal...
sleep 3 ; echo \\nPress '"'"\033[;37m"ENTER"\033[;32m"'"' to reboot...
read hotpips
reboot
